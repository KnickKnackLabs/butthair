#!/usr/bin/env bash
#MISE description="Check Hammerspoon installation and status"

TASKS_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "$TASKS_DIR/_hs"

echo "butthair status"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

# Installation
if [ -x "$HS_CLI" ]; then
    VERSION=$(hs_run "return hs.processInfo.version" || echo "unknown")
    echo "  Installed:     ✓ ($VERSION)"
else
    echo "  Installed:     ✗"
    echo "  Install from https://www.hammerspoon.org/"
    exit 0
fi

# Running
if pgrep -x "Hammerspoon" > /dev/null; then
    echo "  Running:       ✓"
else
    echo "  Running:       ✗"
    exit 0
fi

# Accessibility
ACCESS=$(hs_run "return hs.accessibilityState()")
if [ "$ACCESS" = "true" ]; then
    echo "  Accessibility: ✓"
else
    echo "  Accessibility: ✗ (enable in System Settings → Privacy & Security → Accessibility)"
fi

# Screens
SCREEN_COUNT=$(hs_run "return #hs.screen.allScreens()")
MAIN_SCREEN=$(hs_run "return hs.screen.mainScreen():name()")
echo "  Screens:       $SCREEN_COUNT ($MAIN_SCREEN)"

# Windows
WIN_COUNT=$(hs_run "return #hs.window.allWindows()")
echo "  Windows:       $WIN_COUNT"
